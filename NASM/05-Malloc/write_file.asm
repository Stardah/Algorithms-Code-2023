section .data
    mode db "w", 0              ; строка для режима записи
    path db "output.txt", 0     ; строка для пути к файлу
    format db "%s", 0           ; строка для спецификатора формата
    text db "hello world", 0    ; строка для записи в файл

section .text
    global main 
    extern fopen 
    extern fputs
    extern fclose 
    extern get_stdin

main:
    lea ecx, [esp+4]            ; загружаем адрес адреса возврата в ecx
    and esp, -16                ; выравниваем стек по границе 16 байт
    push DWORD [ecx-4]          ; кладем на стек исходное значение esp
    push ebp                    ; сохраняем старый базовый указатель стека
    mov ebp, esp                ; устанавливаем новый базовый указатель стека

    sub esp, 16                 ; выделяем 16 байт на стеке для указателя на файл

    push mode                   ; кладем на стек строку для режима записи
    push path                   ; кладем на стек строку для пути к файлу
    call fopen                  ; вызываем функцию fopen для открытия или создания файла
    add esp, 16                 ; убираем аргументы со стека
    mov DWORD [ebp-12], eax     ; сохраняем указатель на файл в [ebp-12]

    sub esp, 16                 ; выравниваем стек по границе 16 байт
    push DWORD [ebp-12]         ; кладем на стек указатель на файл
    lea eax, text               ; загружаем адрес строки для записи в eax
    push eax                    ; кладем на стек строку для записи
    call fputs                  ; вызываем функцию fputs для записи строки в файл
    add esp, 16                 ; убираем аргументы со стека

    sub esp, 16                 ; выравниваем стек по границе 16 байт
    push DWORD [ebp-12]         ; кладем на стек указатель на файл
    call fclose                 ; вызываем функцию fclose для закрытия файла
    add esp, 16                 ; убираем аргумент со стека

    mov eax, 0                  ; устанавливаем eax в ноль (без ошибки)

    leave                       ; восстанавливаем esp и извлекаем ebp (эквивалентно mov esp, ebp и pop ebp)
    ret                         ; возвращаемся из главной функции
